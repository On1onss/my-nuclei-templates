id: PortSwigger_Lab_Exploiting_server-side_parameter_pollution_in_a_query_string_medium

info:
  name: Lab - Exploiting server-side parameter pollution in a query string
  author: Bb0LP
  severity: medium
  description: |
    Check for server-side parameter pollution in a query string vulnerability.
  reference:
    - https://portswigger.net/web-security/learning-paths/api-testing/api-testing-testing-for-server-side-parameter-pollution-in-the-query-string/api-testing/server-side-parameter-pollution/lab-exploiting-server-side-parameter-pollution-in-query-string
  tags: ctf,web,labs

http:
  - id: fetch-csrf
    method: GET
    path:
      - "{{BaseURL}}/forgot-password"

    extractors:
      - type: regex
        name: csrf_token
        part: body
        regex:
          - '<input[^>]*name="csrf"[^>]*value="([^"]+)"'
        group: 1
        internal: true

  - id: submit-csrf
    method: POST
    path:
      - "{{BaseURL}}/forgot-password"

    body: "csrf={{csrf_token}}&username=administrator%23"
    headers:
      Content-Type: "application/x-www-form-urlencoded"

    matchers:
      - type: regex
        name: error-detected
        regex:
          - '\{"error":\s*"Field not specified\."\}'
        part: body
